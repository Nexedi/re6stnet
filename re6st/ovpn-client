#!/usr/bin/python -S
import os, sys

script_type = os.environ['script_type']
if script_type == 'up':
    # OpenVPN unsets PATH before calling hooks
    # which is equivalent to set /bin:/usr/bin
    os.environ['PATH'] = '/bin:/sbin:/usr/bin:/usr/sbin'
    os.execlp('ip', 'ip', 'link', 'set', os.environ['dev'], 'up',
              'mtu', os.environ['tun_mtu'])

# Write into pipe external ip address received
import time
os.write(int(sys.argv[1]), "%s %s %s %s\n" % (script_type,
  os.environ['common_name'], time.time(), os.environ['OPENVPN_external_ip']))
